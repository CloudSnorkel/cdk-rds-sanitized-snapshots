{
 "Resources": {
  "MySQLInstanceSnapshotterSGC75DA465": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Group for communication between sanitizing job and database",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "RDS-sanitized-snapshots"
     }
    ],
    "VpcId": {
     "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCB9E5F0B4BD23A326"
    }
   }
  },
  "MySQLInstanceSnapshotterSGfromRDSSanitizedSnapshotterSFNMySQLInstanceSnapshotterSG69AE57C1ALLPORTSE497E70E": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "from RDSSanitizedSnapshotterSFNMySQLInstanceSnapshotterSG69AE57C1:ALL PORTS",
    "FromPort": 0,
    "GroupId": {
     "Fn::GetAtt": [
      "MySQLInstanceSnapshotterSGC75DA465",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "MySQLInstanceSnapshotterSGC75DA465",
      "GroupId"
     ]
    },
    "ToPort": 65535
   }
  },
  "MySQLInstanceSnapshotterSubnetgroup503CB3B3": {
   "Type": "AWS::RDS::DBSubnetGroup",
   "Properties": {
    "DBSubnetGroupDescription": "Temporary database used for RDS-sanitize-snapshots",
    "SubnetIds": [
     {
      "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCPrivateSubnet1Subnet8BCA10E01F79A1B7"
     },
     {
      "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCPrivateSubnet2SubnetCFCDAA7AB22CF85D"
     }
    ]
   }
  },
  "MySQLInstanceSnapshottercluster86DF6015": {
   "Type": "AWS::ECS::Cluster"
  },
  "MySQLInstanceSnapshotterLogs55691739": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "RetentionInDays": 30
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "MySQLInstanceSnapshotterparametersServiceRole0017B602": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "MySQLInstanceSnapshotterparametersServiceRoleDefaultPolicyD8BFD2E0": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "rds:DescribeDBInstances",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:",
          {
           "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLInstanceA2499B9D2BD8E026"
          }
         ]
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLInstanceSnapshotterparametersServiceRoleDefaultPolicyD8BFD2E0",
    "Roles": [
     {
      "Ref": "MySQLInstanceSnapshotterparametersServiceRole0017B602"
     }
    ]
   }
  },
  "MySQLInstanceSnapshotterparameters53B0A6E1": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "73ae9c6df09ad4bfbc13c9d4e1f9695a2de8da41bbb8b0037182a8cda9a710c6.zip"
    },
    "Description": "src/parameters.lambda.ts",
    "Environment": {
     "Variables": {
      "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1"
     }
    },
    "Handler": "index.handler",
    "LoggingConfig": {
     "LogFormat": "JSON",
     "LogGroup": {
      "Ref": "MySQLInstanceSnapshotterLogs55691739"
     }
    },
    "Role": {
     "Fn::GetAtt": [
      "MySQLInstanceSnapshotterparametersServiceRole0017B602",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x"
   },
   "DependsOn": [
    "MySQLInstanceSnapshotterparametersServiceRoleDefaultPolicyD8BFD2E0",
    "MySQLInstanceSnapshotterparametersServiceRole0017B602"
   ]
  },
  "MySQLInstanceSnapshotterwaitServiceRole21AAE4F2": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "MySQLInstanceSnapshotterwaitServiceRoleDefaultPolicyE6063975": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "rds:DescribeDBClusters",
        "rds:DescribeDBClusterSnapshots",
        "rds:DescribeDBSnapshots",
        "rds:DescribeDBInstances"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:",
           {
            "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLInstanceA2499B9D2BD8E026"
           }
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:",
           {
            "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLInstanceA2499B9D2BD8E026"
           }
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:mysql-instance-snapshot-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLInstanceSnapshotterwaitServiceRoleDefaultPolicyE6063975",
    "Roles": [
     {
      "Ref": "MySQLInstanceSnapshotterwaitServiceRole21AAE4F2"
     }
    ]
   }
  },
  "MySQLInstanceSnapshotterwait17927A95": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "66486f7e33c34ceaae0d26eda8231c31f462018de9b6f34e598b3cc0df48b44f.zip"
    },
    "Description": "src/wait.lambda.ts",
    "Environment": {
     "Variables": {
      "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1"
     }
    },
    "Handler": "index.handler",
    "LoggingConfig": {
     "LogFormat": "JSON",
     "LogGroup": {
      "Ref": "MySQLInstanceSnapshotterLogs55691739"
     }
    },
    "Role": {
     "Fn::GetAtt": [
      "MySQLInstanceSnapshotterwaitServiceRole21AAE4F2",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x"
   },
   "DependsOn": [
    "MySQLInstanceSnapshotterwaitServiceRoleDefaultPolicyE6063975",
    "MySQLInstanceSnapshotterwaitServiceRole21AAE4F2"
   ]
  },
  "MySQLInstanceSnapshotterMySQLTaskTaskRoleBFA1FB36": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLInstanceSnapshotterMySQLTask45C5FE96": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Command": [
       "bash",
       "-c",
       "echo \"[client]\nuser=$MYSQL_USER\nhost=$MYSQL_HOST\nport=$MYSQL_PORT\npassword=$MYSQL_PASSWORD\" > ~/.my.cnf && chmod 700 ~/.my.cnf"
      ],
      "Essential": false,
      "Image": "public.ecr.aws/docker/library/bash:4-alpine3.15",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "MySQLInstanceSnapshotterLogs55691739"
        },
        "awslogs-stream-prefix": "mysql-config",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "MountPoints": [
       {
        "ContainerPath": "/root",
        "ReadOnly": false,
        "SourceVolume": "config"
       }
      ],
      "Name": "config"
     },
     {
      "Command": [
       "mysql",
       "-e",
       "SELECT 1"
      ],
      "DependsOn": [
       {
        "Condition": "SUCCESS",
        "ContainerName": "config"
       }
      ],
      "Essential": true,
      "Image": "public.ecr.aws/lts/mysql:latest",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "MySQLInstanceSnapshotterLogs55691739"
        },
        "awslogs-stream-prefix": "mysql-sanitize",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "MountPoints": [
       {
        "ContainerPath": "/root",
        "ReadOnly": true,
        "SourceVolume": "config"
       }
      ],
      "Name": "mysql"
     }
    ],
    "Cpu": "256",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "MySQLInstanceSnapshotterMySQLTaskExecutionRole1DD381B7",
      "Arn"
     ]
    },
    "Family": "RDSSanitizedSnapshotterSFNMySQLInstanceSnapshotterMySQLTask5753E21D",
    "Memory": "512",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "MySQLInstanceSnapshotterMySQLTaskTaskRoleBFA1FB36",
      "Arn"
     ]
    },
    "Volumes": [
     {
      "Host": {},
      "Name": "config"
     }
    ]
   }
  },
  "MySQLInstanceSnapshotterMySQLTaskExecutionRole1DD381B7": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLInstanceSnapshotterMySQLTaskExecutionRoleDefaultPolicy99EE7B1E": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterLogs55691739",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLInstanceSnapshotterMySQLTaskExecutionRoleDefaultPolicy99EE7B1E",
    "Roles": [
     {
      "Ref": "MySQLInstanceSnapshotterMySQLTaskExecutionRole1DD381B7"
     }
    ]
   }
  },
  "MySQLInstanceSnapshotterPostreSQLTaskTaskRole82DDF085": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLInstanceSnapshotterPostreSQLTaskFAABAACF": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Command": [
       "psql",
       "-c",
       "SELECT 1"
      ],
      "Essential": true,
      "Image": "public.ecr.aws/lts/postgres:latest",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "MySQLInstanceSnapshotterLogs55691739"
        },
        "awslogs-stream-prefix": "psql-sanitize",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "Name": "postgres"
     }
    ],
    "Cpu": "256",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "MySQLInstanceSnapshotterPostreSQLTaskExecutionRole78969E33",
      "Arn"
     ]
    },
    "Family": "RDSSanitizedSnapshotterSFNMySQLInstanceSnapshotterPostreSQLTask702D64B7",
    "Memory": "512",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "MySQLInstanceSnapshotterPostreSQLTaskTaskRole82DDF085",
      "Arn"
     ]
    }
   }
  },
  "MySQLInstanceSnapshotterPostreSQLTaskExecutionRole78969E33": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLInstanceSnapshotterPostreSQLTaskExecutionRoleDefaultPolicy78800565": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterLogs55691739",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLInstanceSnapshotterPostreSQLTaskExecutionRoleDefaultPolicy78800565",
    "Roles": [
     {
      "Ref": "MySQLInstanceSnapshotterPostreSQLTaskExecutionRole78969E33"
     }
    ]
   }
  },
  "MySQLInstanceSnapshotterDirectorRoleE2669C80": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": {
         "Fn::FindInMap": [
          "ServiceprincipalMap",
          {
           "Ref": "AWS::Region"
          },
          "states"
         ]
        }
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLInstanceSnapshotterDirectorRoleDefaultPolicyF62C2EC2": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "MySQLInstanceSnapshotterparameters53B0A6E1",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "MySQLInstanceSnapshotterparameters53B0A6E1",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:deleteDBSnapshot",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":snapshot:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:deleteDBInstance",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:createDBSnapshot",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "MySQLInstanceSnapshotterwait17927A95",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "MySQLInstanceSnapshotterwait17927A95",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:restoreDBInstanceFromDBSnapshot",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":subgrp:",
           {
            "Ref": "MySQLInstanceSnapshotterSubnetgroup503CB3B3"
           }
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:modifyDBInstance",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:describeDBInstances",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "ecs:RunTask",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLInstanceSnapshotterMySQLTask45C5FE96"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            2,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLInstanceSnapshotterMySQLTask45C5FE96"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            3,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLInstanceSnapshotterMySQLTask45C5FE96"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            4,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLInstanceSnapshotterMySQLTask45C5FE96"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            0,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "MySQLInstanceSnapshotterMySQLTask45C5FE96"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          },
          "/",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "MySQLInstanceSnapshotterMySQLTask45C5FE96"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      },
      {
       "Action": [
        "ecs:StopTask",
        "ecs:DescribeTasks"
       ],
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "iam:PassRole",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "MySQLInstanceSnapshotterMySQLTaskTaskRoleBFA1FB36",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "MySQLInstanceSnapshotterMySQLTaskExecutionRole1DD381B7",
          "Arn"
         ]
        }
       ]
      },
      {
       "Action": [
        "events:PutTargets",
        "events:PutRule",
        "events:DescribeRule"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":events:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":rule/StepFunctionsGetEventsForECSTaskRule"
         ]
        ]
       }
      },
      {
       "Action": "ecs:RunTask",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLInstanceSnapshotterPostreSQLTaskFAABAACF"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            2,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLInstanceSnapshotterPostreSQLTaskFAABAACF"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            3,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLInstanceSnapshotterPostreSQLTaskFAABAACF"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            4,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLInstanceSnapshotterPostreSQLTaskFAABAACF"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            0,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "MySQLInstanceSnapshotterPostreSQLTaskFAABAACF"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          },
          "/",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "MySQLInstanceSnapshotterPostreSQLTaskFAABAACF"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      },
      {
       "Action": "iam:PassRole",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "MySQLInstanceSnapshotterPostreSQLTaskTaskRole82DDF085",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "MySQLInstanceSnapshotterPostreSQLTaskExecutionRole78969E33",
          "Arn"
         ]
        }
       ]
      },
      {
       "Action": "rds:AddTagsToResource",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:mysql-instance-snapshot-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLInstanceSnapshotterDirectorRoleDefaultPolicyF62C2EC2",
    "Roles": [
     {
      "Ref": "MySQLInstanceSnapshotterDirectorRoleE2669C80"
     }
    ]
   }
  },
  "MySQLInstanceSnapshotterDirector69A6B7B4": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"Get Parameters\",\"States\":{\"Get Parameters\":{\"Next\":\"Error Catcher\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterparameters53B0A6E1",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"executionId.$\":\"$$.Execution.Id\",\"isCluster\":false,\"databaseIdentifier\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLInstanceA2499B9D2BD8E026"
       },
       "\",\"databaseKey\":\"\",\"snapshotPrefix\":\"mysql-instance-snapshot\",\"tempPrefix\":\"sanitize\"}},\"Error Catcher\":{\"Type\":\"Parallel\",\"ResultPath\":null,\"Next\":\"Cleanup\",\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":null,\"Next\":\"Cleanup\"}],\"Branches\":[{\"StartAt\":\"Create Temporary Snapshot\",\"States\":{\"Create Temporary Snapshot\":{\"Next\":\"Wait for Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBSnapshot\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.databaseIdentifier\",\"DbSnapshotIdentifier.$\":\"$.tempSnapshotId\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLInstanceA2499B9D2BD8E026"
       },
       "\"}]}},\"Wait for Snapshot\":{\"Next\":\"Create Temporary Database\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterwait17927A95",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"snapshot\",\"databaseIdentifier.$\":\"$.databaseIdentifier\",\"snapshotIdentifier.$\":\"$.tempSnapshotId\",\"isCluster\":false}},\"Create Temporary Database\":{\"Next\":\"Wait for Temporary Database\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:restoreDBInstanceFromDBSnapshot\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\",\"Engine.$\":\"$.engine\",\"DbSnapshotIdentifier.$\":\"$.tempSnapshotId\",\"PubliclyAccessible\":false,\"VpcSecurityGroupIds\":[\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterSGC75DA465",
         "GroupId"
        ]
       },
       "\"],\"DbSubnetGroupName\":\"",
       {
        "Ref": "MySQLInstanceSnapshotterSubnetgroup503CB3B3"
       },
       "\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLInstanceA2499B9D2BD8E026"
       },
       "\"}]}},\"Wait for Temporary Database\":{\"Next\":\"Set Temporary Password\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterwait17927A95",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"instance\",\"databaseIdentifier.$\":\"$.tempDbId\",\"isCluster\":false}},\"Set Temporary Password\":{\"Next\":\"Wait for Temporary Password\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:modifyDBInstance\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\",\"MasterUserPassword.$\":\"$.tempDb.password\",\"ApplyImmediately\":true,\"BackupRetentionPeriod\":0}},\"Wait for Temporary Password\":{\"Next\":\"Get Temporary Endpoint\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterwait17927A95",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"instance\",\"databaseIdentifier.$\":\"$.tempDbId\",\"isCluster\":false}},\"Get Temporary Endpoint\":{\"Next\":\"Sanitize\",\"Type\":\"Task\",\"ResultPath\":\"$.tempDb.host\",\"ResultSelector\":{\"endpoint.$\":\"$.DbInstances[0].Endpoint.Address\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:describeDBInstances\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\"}},\"Sanitize\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.dockerImage\",\"StringEquals\":\"mysql\",\"Next\":\"Sanitize MySQL\"},{\"Variable\":\"$.dockerImage\",\"StringEquals\":\"postgres\",\"Next\":\"Sanitize Postgres\"}]},\"Sanitize MySQL\":{\"Next\":\"Create Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::ecs:runTask.sync\",\"Parameters\":{\"Cluster\":\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshottercluster86DF6015",
         "Arn"
        ]
       },
       "\",\"TaskDefinition\":\"RDSSanitizedSnapshotterSFNMySQLInstanceSnapshotterMySQLTask5753E21D\",\"NetworkConfiguration\":{\"AwsvpcConfiguration\":{\"Subnets\":[\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet1SubnetEBD00FC6298E81EF"
       },
       "\",\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet2Subnet4B1C8CAAD8B83B81"
       },
       "\"],\"SecurityGroups\":[\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterSGC75DA465",
         "GroupId"
        ]
       },
       "\"]}},\"Overrides\":{\"ContainerOverrides\":[{\"Name\":\"config\",\"Environment\":[{\"Name\":\"MYSQL_HOST\",\"Value.$\":\"$.tempDb.host.endpoint\"},{\"Name\":\"MYSQL_PORT\",\"Value.$\":\"$.tempDb.port\"},{\"Name\":\"MYSQL_USER\",\"Value.$\":\"$.tempDb.user\"},{\"Name\":\"MYSQL_PASSWORD\",\"Value.$\":\"$.tempDb.password\"},{\"Name\":\"MYSQL_DATABASE\",\"Value\":\"\"}]}]},\"LaunchType\":\"FARGATE\"}},\"Create Final Snapshot\":{\"Next\":\"Wait for Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBSnapshot\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\",\"DbSnapshotIdentifier.$\":\"$.targetSnapshotId\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLInstanceA2499B9D2BD8E026"
       },
       "\"},{\"Key\":\"Final\",\"Value\":\"true\"}]}},\"Sanitize Postgres\":{\"Next\":\"Create Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::ecs:runTask.sync\",\"Parameters\":{\"Cluster\":\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshottercluster86DF6015",
         "Arn"
        ]
       },
       "\",\"TaskDefinition\":\"RDSSanitizedSnapshotterSFNMySQLInstanceSnapshotterPostreSQLTask702D64B7\",\"NetworkConfiguration\":{\"AwsvpcConfiguration\":{\"Subnets\":[\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet1SubnetEBD00FC6298E81EF"
       },
       "\",\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet2Subnet4B1C8CAAD8B83B81"
       },
       "\"],\"SecurityGroups\":[\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterSGC75DA465",
         "GroupId"
        ]
       },
       "\"]}},\"Overrides\":{\"ContainerOverrides\":[{\"Name\":\"postgres\",\"Environment\":[{\"Name\":\"PGHOST\",\"Value.$\":\"$.tempDb.host.endpoint\"},{\"Name\":\"PGPORT\",\"Value.$\":\"$.tempDb.port\"},{\"Name\":\"PGUSER\",\"Value.$\":\"$.tempDb.user\"},{\"Name\":\"PGPASSWORD\",\"Value.$\":\"$.tempDb.password\"},{\"Name\":\"PGDATABASE\",\"Value\":\"postgres\"},{\"Name\":\"PGCONNECT_TIMEOUT\",\"Value\":\"30\"}]}]},\"LaunchType\":\"FARGATE\"}},\"Wait for Final Snapshot\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLInstanceSnapshotterwait17927A95",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"snapshot\",\"databaseIdentifier.$\":\"$.tempDbId\",\"snapshotIdentifier.$\":\"$.targetSnapshotId\",\"isCluster\":false}}}}]},\"Cleanup\":{\"Type\":\"Parallel\",\"ResultPath\":null,\"End\":true,\"Branches\":[{\"StartAt\":\"Temporary Snapshot\",\"States\":{\"Temporary Snapshot\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBSnapshot\",\"Parameters\":{\"DbSnapshotIdentifier.$\":\"$.tempSnapshotId\"}}}},{\"StartAt\":\"Temporary Database Instance\",\"States\":{\"Temporary Database Instance\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBInstance\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\",\"SkipFinalSnapshot\":true}}}}]}}}"
      ]
     ]
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "MySQLInstanceSnapshotterDirectorRoleE2669C80",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "MySQLInstanceSnapshotterDirectorRoleDefaultPolicyF62C2EC2",
    "MySQLInstanceSnapshotterDirectorRoleE2669C80"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "MySQLClusterSnapshotterSGF5188D63": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Group for communication between sanitizing job and database",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "RDS-sanitized-snapshots"
     }
    ],
    "VpcId": {
     "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCB9E5F0B4BD23A326"
    }
   }
  },
  "MySQLClusterSnapshotterSGfromRDSSanitizedSnapshotterSFNMySQLClusterSnapshotterSG88C422B1ALLPORTS9D3E93FA": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "from RDSSanitizedSnapshotterSFNMySQLClusterSnapshotterSG88C422B1:ALL PORTS",
    "FromPort": 0,
    "GroupId": {
     "Fn::GetAtt": [
      "MySQLClusterSnapshotterSGF5188D63",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "MySQLClusterSnapshotterSGF5188D63",
      "GroupId"
     ]
    },
    "ToPort": 65535
   }
  },
  "MySQLClusterSnapshotterSubnetgroupF2F35C6A": {
   "Type": "AWS::RDS::DBSubnetGroup",
   "Properties": {
    "DBSubnetGroupDescription": "Temporary database used for RDS-sanitize-snapshots",
    "SubnetIds": [
     {
      "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCPrivateSubnet1Subnet8BCA10E01F79A1B7"
     },
     {
      "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCPrivateSubnet2SubnetCFCDAA7AB22CF85D"
     }
    ]
   }
  },
  "MySQLClusterSnapshottercluster9B2B4982": {
   "Type": "AWS::ECS::Cluster"
  },
  "MySQLClusterSnapshotterLogs987A7E0A": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "RetentionInDays": 30
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "MySQLClusterSnapshotterparametersServiceRole4959428F": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "MySQLClusterSnapshotterparametersServiceRoleDefaultPolicy9544C62B": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "rds:DescribeDBClusters",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster:",
          {
           "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLClusterD5C73C3376F94030"
          }
         ]
        ]
       }
      },
      {
       "Action": "rds:DescribeDBInstances",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLClusterSnapshotterparametersServiceRoleDefaultPolicy9544C62B",
    "Roles": [
     {
      "Ref": "MySQLClusterSnapshotterparametersServiceRole4959428F"
     }
    ]
   }
  },
  "MySQLClusterSnapshotterparametersAF9FF89F": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "73ae9c6df09ad4bfbc13c9d4e1f9695a2de8da41bbb8b0037182a8cda9a710c6.zip"
    },
    "Description": "src/parameters.lambda.ts",
    "Environment": {
     "Variables": {
      "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1"
     }
    },
    "Handler": "index.handler",
    "LoggingConfig": {
     "LogFormat": "JSON",
     "LogGroup": {
      "Ref": "MySQLClusterSnapshotterLogs987A7E0A"
     }
    },
    "Role": {
     "Fn::GetAtt": [
      "MySQLClusterSnapshotterparametersServiceRole4959428F",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x"
   },
   "DependsOn": [
    "MySQLClusterSnapshotterparametersServiceRoleDefaultPolicy9544C62B",
    "MySQLClusterSnapshotterparametersServiceRole4959428F"
   ]
  },
  "MySQLClusterSnapshotterwaitServiceRoleD1DB455D": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "MySQLClusterSnapshotterwaitServiceRoleDefaultPolicy9E878AF7": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "rds:DescribeDBClusters",
        "rds:DescribeDBClusterSnapshots",
        "rds:DescribeDBSnapshots",
        "rds:DescribeDBInstances"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:",
           {
            "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLClusterD5C73C3376F94030"
           }
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:",
           {
            "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLClusterD5C73C3376F94030"
           }
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:mysql-cluster-snapshot-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLClusterSnapshotterwaitServiceRoleDefaultPolicy9E878AF7",
    "Roles": [
     {
      "Ref": "MySQLClusterSnapshotterwaitServiceRoleD1DB455D"
     }
    ]
   }
  },
  "MySQLClusterSnapshotterwait73D57C6D": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "66486f7e33c34ceaae0d26eda8231c31f462018de9b6f34e598b3cc0df48b44f.zip"
    },
    "Description": "src/wait.lambda.ts",
    "Environment": {
     "Variables": {
      "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1"
     }
    },
    "Handler": "index.handler",
    "LoggingConfig": {
     "LogFormat": "JSON",
     "LogGroup": {
      "Ref": "MySQLClusterSnapshotterLogs987A7E0A"
     }
    },
    "Role": {
     "Fn::GetAtt": [
      "MySQLClusterSnapshotterwaitServiceRoleD1DB455D",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x"
   },
   "DependsOn": [
    "MySQLClusterSnapshotterwaitServiceRoleDefaultPolicy9E878AF7",
    "MySQLClusterSnapshotterwaitServiceRoleD1DB455D"
   ]
  },
  "MySQLClusterSnapshotterMySQLTaskTaskRole3BAE9027": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLClusterSnapshotterMySQLTask8414A409": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Command": [
       "bash",
       "-c",
       "echo \"[client]\nuser=$MYSQL_USER\nhost=$MYSQL_HOST\nport=$MYSQL_PORT\npassword=$MYSQL_PASSWORD\" > ~/.my.cnf && chmod 700 ~/.my.cnf"
      ],
      "Essential": false,
      "Image": "public.ecr.aws/docker/library/bash:4-alpine3.15",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "MySQLClusterSnapshotterLogs987A7E0A"
        },
        "awslogs-stream-prefix": "mysql-config",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "MountPoints": [
       {
        "ContainerPath": "/root",
        "ReadOnly": false,
        "SourceVolume": "config"
       }
      ],
      "Name": "config"
     },
     {
      "Command": [
       "mysql",
       "-e",
       "SELECT 1"
      ],
      "DependsOn": [
       {
        "Condition": "SUCCESS",
        "ContainerName": "config"
       }
      ],
      "Essential": true,
      "Image": "public.ecr.aws/lts/mysql:latest",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "MySQLClusterSnapshotterLogs987A7E0A"
        },
        "awslogs-stream-prefix": "mysql-sanitize",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "MountPoints": [
       {
        "ContainerPath": "/root",
        "ReadOnly": true,
        "SourceVolume": "config"
       }
      ],
      "Name": "mysql"
     }
    ],
    "Cpu": "256",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "MySQLClusterSnapshotterMySQLTaskExecutionRole50CCB6FA",
      "Arn"
     ]
    },
    "Family": "RDSSanitizedSnapshotterSFNMySQLClusterSnapshotterMySQLTask813891E0",
    "Memory": "512",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "MySQLClusterSnapshotterMySQLTaskTaskRole3BAE9027",
      "Arn"
     ]
    },
    "Volumes": [
     {
      "Host": {},
      "Name": "config"
     }
    ]
   }
  },
  "MySQLClusterSnapshotterMySQLTaskExecutionRole50CCB6FA": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLClusterSnapshotterMySQLTaskExecutionRoleDefaultPolicy109BFD8B": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterLogs987A7E0A",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLClusterSnapshotterMySQLTaskExecutionRoleDefaultPolicy109BFD8B",
    "Roles": [
     {
      "Ref": "MySQLClusterSnapshotterMySQLTaskExecutionRole50CCB6FA"
     }
    ]
   }
  },
  "MySQLClusterSnapshotterPostreSQLTaskTaskRole09172C54": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLClusterSnapshotterPostreSQLTaskB18030B4": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Command": [
       "psql",
       "-c",
       "SELECT 1"
      ],
      "Essential": true,
      "Image": "public.ecr.aws/lts/postgres:latest",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "MySQLClusterSnapshotterLogs987A7E0A"
        },
        "awslogs-stream-prefix": "psql-sanitize",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "Name": "postgres"
     }
    ],
    "Cpu": "256",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "MySQLClusterSnapshotterPostreSQLTaskExecutionRole430431E0",
      "Arn"
     ]
    },
    "Family": "RDSSanitizedSnapshotterSFNMySQLClusterSnapshotterPostreSQLTask8BE86494",
    "Memory": "512",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "MySQLClusterSnapshotterPostreSQLTaskTaskRole09172C54",
      "Arn"
     ]
    }
   }
  },
  "MySQLClusterSnapshotterPostreSQLTaskExecutionRole430431E0": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLClusterSnapshotterPostreSQLTaskExecutionRoleDefaultPolicyBFF6CA44": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterLogs987A7E0A",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLClusterSnapshotterPostreSQLTaskExecutionRoleDefaultPolicyBFF6CA44",
    "Roles": [
     {
      "Ref": "MySQLClusterSnapshotterPostreSQLTaskExecutionRole430431E0"
     }
    ]
   }
  },
  "MySQLClusterSnapshotterDirectorRole6035EB89": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": {
         "Fn::FindInMap": [
          "ServiceprincipalMap",
          {
           "Ref": "AWS::Region"
          },
          "states"
         ]
        }
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "MySQLClusterSnapshotterDirectorRoleDefaultPolicy78A869F9": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "MySQLClusterSnapshotterparametersAF9FF89F",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "MySQLClusterSnapshotterparametersAF9FF89F",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:deleteDBClusterSnapshot",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster-snapshot:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:deleteDBInstance",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:deleteDBCluster",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:createDBClusterSnapshot",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "MySQLClusterSnapshotterwait73D57C6D",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "MySQLClusterSnapshotterwait73D57C6D",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:restoreDBClusterFromSnapshot",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":subgrp:",
           {
            "Ref": "MySQLClusterSnapshotterSubnetgroupF2F35C6A"
           }
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:modifyDBCluster",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:createDBInstance",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:describeDBClusters",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "ecs:RunTask",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLClusterSnapshotterMySQLTask8414A409"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            2,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLClusterSnapshotterMySQLTask8414A409"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            3,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLClusterSnapshotterMySQLTask8414A409"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            4,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLClusterSnapshotterMySQLTask8414A409"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            0,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "MySQLClusterSnapshotterMySQLTask8414A409"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          },
          "/",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "MySQLClusterSnapshotterMySQLTask8414A409"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      },
      {
       "Action": [
        "ecs:StopTask",
        "ecs:DescribeTasks"
       ],
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "iam:PassRole",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "MySQLClusterSnapshotterMySQLTaskTaskRole3BAE9027",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "MySQLClusterSnapshotterMySQLTaskExecutionRole50CCB6FA",
          "Arn"
         ]
        }
       ]
      },
      {
       "Action": [
        "events:PutTargets",
        "events:PutRule",
        "events:DescribeRule"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":events:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":rule/StepFunctionsGetEventsForECSTaskRule"
         ]
        ]
       }
      },
      {
       "Action": "ecs:RunTask",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLClusterSnapshotterPostreSQLTaskB18030B4"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            2,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLClusterSnapshotterPostreSQLTaskB18030B4"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            3,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLClusterSnapshotterPostreSQLTaskB18030B4"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            4,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "MySQLClusterSnapshotterPostreSQLTaskB18030B4"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            0,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "MySQLClusterSnapshotterPostreSQLTaskB18030B4"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          },
          "/",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "MySQLClusterSnapshotterPostreSQLTaskB18030B4"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      },
      {
       "Action": "iam:PassRole",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "MySQLClusterSnapshotterPostreSQLTaskTaskRole09172C54",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "MySQLClusterSnapshotterPostreSQLTaskExecutionRole430431E0",
          "Arn"
         ]
        }
       ]
      },
      {
       "Action": "rds:AddTagsToResource",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:mysql-cluster-snapshot-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "MySQLClusterSnapshotterDirectorRoleDefaultPolicy78A869F9",
    "Roles": [
     {
      "Ref": "MySQLClusterSnapshotterDirectorRole6035EB89"
     }
    ]
   }
  },
  "MySQLClusterSnapshotterDirector73A14BB0": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"Get Parameters\",\"States\":{\"Get Parameters\":{\"Next\":\"Error Catcher\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterparametersAF9FF89F",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"executionId.$\":\"$$.Execution.Id\",\"isCluster\":true,\"databaseIdentifier\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLClusterD5C73C3376F94030"
       },
       "\",\"databaseKey\":\"\",\"snapshotPrefix\":\"mysql-cluster-snapshot\",\"tempPrefix\":\"sanitize\"}},\"Error Catcher\":{\"Type\":\"Parallel\",\"ResultPath\":null,\"Next\":\"Cleanup\",\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":null,\"Next\":\"Cleanup\"}],\"Branches\":[{\"StartAt\":\"Create Temporary Snapshot\",\"States\":{\"Create Temporary Snapshot\":{\"Next\":\"Wait for Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBClusterSnapshot\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.databaseIdentifier\",\"DbClusterSnapshotIdentifier.$\":\"$.tempSnapshotId\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLClusterD5C73C3376F94030"
       },
       "\"}]}},\"Wait for Snapshot\":{\"Next\":\"Create Temporary Database\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterwait73D57C6D",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"snapshot\",\"databaseIdentifier.$\":\"$.databaseIdentifier\",\"snapshotIdentifier.$\":\"$.tempSnapshotId\",\"isCluster\":true}},\"Create Temporary Database\":{\"Next\":\"Wait for Temporary Database\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:restoreDBClusterFromSnapshot\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"Engine.$\":\"$.engine\",\"SnapshotIdentifier.$\":\"$.tempSnapshotId\",\"PubliclyAccessible\":false,\"VpcSecurityGroupIds\":[\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterSGF5188D63",
         "GroupId"
        ]
       },
       "\"],\"DbSubnetGroupName\":\"",
       {
        "Ref": "MySQLClusterSnapshotterSubnetgroupF2F35C6A"
       },
       "\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLClusterD5C73C3376F94030"
       },
       "\"}]}},\"Wait for Temporary Database\":{\"Next\":\"Set Temporary Password\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterwait73D57C6D",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"cluster\",\"databaseIdentifier.$\":\"$.tempDbId\",\"isCluster\":true}},\"Set Temporary Password\":{\"Next\":\"Wait for Temporary Password\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:modifyDBCluster\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"MasterUserPassword.$\":\"$.tempDb.password\",\"ApplyImmediately\":true}},\"Wait for Temporary Password\":{\"Next\":\"Create Temporary Instance\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterwait73D57C6D",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"cluster\",\"databaseIdentifier.$\":\"$.tempDbId\",\"isCluster\":true}},\"Create Temporary Instance\":{\"Next\":\"Wait for Temporary Instance\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBInstance\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"DbInstanceIdentifier.$\":\"$.tempDbInstanceId\",\"DbInstanceClass.$\":\"$.tempDbInstanceClass\",\"Engine.$\":\"$.engine\"}},\"Wait for Temporary Instance\":{\"Next\":\"Get Temporary Cluster Endpoint\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterwait73D57C6D",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"instance\",\"databaseIdentifier.$\":\"$.tempDbInstanceId\",\"isCluster\":true}},\"Get Temporary Cluster Endpoint\":{\"Next\":\"Sanitize\",\"Type\":\"Task\",\"ResultPath\":\"$.tempDb.host\",\"ResultSelector\":{\"endpoint.$\":\"$.DbClusters[0].Endpoint\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:describeDBClusters\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\"}},\"Sanitize\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.dockerImage\",\"StringEquals\":\"mysql\",\"Next\":\"Sanitize MySQL\"},{\"Variable\":\"$.dockerImage\",\"StringEquals\":\"postgres\",\"Next\":\"Sanitize Postgres\"}]},\"Sanitize MySQL\":{\"Next\":\"Create Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::ecs:runTask.sync\",\"Parameters\":{\"Cluster\":\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshottercluster9B2B4982",
         "Arn"
        ]
       },
       "\",\"TaskDefinition\":\"RDSSanitizedSnapshotterSFNMySQLClusterSnapshotterMySQLTask813891E0\",\"NetworkConfiguration\":{\"AwsvpcConfiguration\":{\"Subnets\":[\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet1SubnetEBD00FC6298E81EF"
       },
       "\",\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet2Subnet4B1C8CAAD8B83B81"
       },
       "\"],\"SecurityGroups\":[\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterSGF5188D63",
         "GroupId"
        ]
       },
       "\"]}},\"Overrides\":{\"ContainerOverrides\":[{\"Name\":\"config\",\"Environment\":[{\"Name\":\"MYSQL_HOST\",\"Value.$\":\"$.tempDb.host.endpoint\"},{\"Name\":\"MYSQL_PORT\",\"Value.$\":\"$.tempDb.port\"},{\"Name\":\"MYSQL_USER\",\"Value.$\":\"$.tempDb.user\"},{\"Name\":\"MYSQL_PASSWORD\",\"Value.$\":\"$.tempDb.password\"},{\"Name\":\"MYSQL_DATABASE\",\"Value\":\"\"}]}]},\"LaunchType\":\"FARGATE\"}},\"Create Final Snapshot\":{\"Next\":\"Wait for Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBClusterSnapshot\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"DbClusterSnapshotIdentifier.$\":\"$.targetSnapshotId\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefMySQLClusterD5C73C3376F94030"
       },
       "\"},{\"Key\":\"Final\",\"Value\":\"true\"}]}},\"Sanitize Postgres\":{\"Next\":\"Create Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::ecs:runTask.sync\",\"Parameters\":{\"Cluster\":\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshottercluster9B2B4982",
         "Arn"
        ]
       },
       "\",\"TaskDefinition\":\"RDSSanitizedSnapshotterSFNMySQLClusterSnapshotterPostreSQLTask8BE86494\",\"NetworkConfiguration\":{\"AwsvpcConfiguration\":{\"Subnets\":[\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet1SubnetEBD00FC6298E81EF"
       },
       "\",\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet2Subnet4B1C8CAAD8B83B81"
       },
       "\"],\"SecurityGroups\":[\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterSGF5188D63",
         "GroupId"
        ]
       },
       "\"]}},\"Overrides\":{\"ContainerOverrides\":[{\"Name\":\"postgres\",\"Environment\":[{\"Name\":\"PGHOST\",\"Value.$\":\"$.tempDb.host.endpoint\"},{\"Name\":\"PGPORT\",\"Value.$\":\"$.tempDb.port\"},{\"Name\":\"PGUSER\",\"Value.$\":\"$.tempDb.user\"},{\"Name\":\"PGPASSWORD\",\"Value.$\":\"$.tempDb.password\"},{\"Name\":\"PGDATABASE\",\"Value\":\"postgres\"},{\"Name\":\"PGCONNECT_TIMEOUT\",\"Value\":\"30\"}]}]},\"LaunchType\":\"FARGATE\"}},\"Wait for Final Snapshot\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "MySQLClusterSnapshotterwait73D57C6D",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"snapshot\",\"databaseIdentifier.$\":\"$.tempDbId\",\"snapshotIdentifier.$\":\"$.targetSnapshotId\",\"isCluster\":true}}}}]},\"Cleanup\":{\"Type\":\"Parallel\",\"ResultPath\":null,\"End\":true,\"Branches\":[{\"StartAt\":\"Temporary Snapshot\",\"States\":{\"Temporary Snapshot\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBClusterSnapshot\",\"Parameters\":{\"DbClusterSnapshotIdentifier.$\":\"$.tempSnapshotId\"}}}},{\"StartAt\":\"Temporary Database Instance\",\"States\":{\"Temporary Database Instance\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBInstance\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbInstanceId\",\"SkipFinalSnapshot\":true}}}},{\"StartAt\":\"Temporary Database\",\"States\":{\"Temporary Database\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBCluster\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"SkipFinalSnapshot\":true}}}}]}}}"
      ]
     ]
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "MySQLClusterSnapshotterDirectorRole6035EB89",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "MySQLClusterSnapshotterDirectorRoleDefaultPolicy78A869F9",
    "MySQLClusterSnapshotterDirectorRole6035EB89"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "PostgreSQLInstanceSnapshotterSG97FD02BB": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Group for communication between sanitizing job and database",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "RDS-sanitized-snapshots"
     }
    ],
    "VpcId": {
     "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCB9E5F0B4BD23A326"
    }
   }
  },
  "PostgreSQLInstanceSnapshotterSGfromRDSSanitizedSnapshotterSFNPostgreSQLInstanceSnapshotterSG52C89F5AALLPORTSEF1B0737": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "from RDSSanitizedSnapshotterSFNPostgreSQLInstanceSnapshotterSG52C89F5A:ALL PORTS",
    "FromPort": 0,
    "GroupId": {
     "Fn::GetAtt": [
      "PostgreSQLInstanceSnapshotterSG97FD02BB",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "PostgreSQLInstanceSnapshotterSG97FD02BB",
      "GroupId"
     ]
    },
    "ToPort": 65535
   }
  },
  "PostgreSQLInstanceSnapshotterSubnetgroup7F19C7EE": {
   "Type": "AWS::RDS::DBSubnetGroup",
   "Properties": {
    "DBSubnetGroupDescription": "Temporary database used for RDS-sanitize-snapshots",
    "SubnetIds": [
     {
      "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCPrivateSubnet1Subnet8BCA10E01F79A1B7"
     },
     {
      "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCPrivateSubnet2SubnetCFCDAA7AB22CF85D"
     }
    ]
   }
  },
  "PostgreSQLInstanceSnapshottercluster067EC069": {
   "Type": "AWS::ECS::Cluster"
  },
  "PostgreSQLInstanceSnapshotterLogsF028D514": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "RetentionInDays": 30
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "PostgreSQLInstanceSnapshotterparametersServiceRole23B2E630": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "PostgreSQLInstanceSnapshotterparametersServiceRoleDefaultPolicy9C4B4594": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "rds:DescribeDBInstances",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:",
          {
           "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresInstance8F00D2DD14EE3CD9"
          }
         ]
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLInstanceSnapshotterparametersServiceRoleDefaultPolicy9C4B4594",
    "Roles": [
     {
      "Ref": "PostgreSQLInstanceSnapshotterparametersServiceRole23B2E630"
     }
    ]
   }
  },
  "PostgreSQLInstanceSnapshotterparametersA0CF862A": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "73ae9c6df09ad4bfbc13c9d4e1f9695a2de8da41bbb8b0037182a8cda9a710c6.zip"
    },
    "Description": "src/parameters.lambda.ts",
    "Environment": {
     "Variables": {
      "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1"
     }
    },
    "Handler": "index.handler",
    "LoggingConfig": {
     "LogFormat": "JSON",
     "LogGroup": {
      "Ref": "PostgreSQLInstanceSnapshotterLogsF028D514"
     }
    },
    "Role": {
     "Fn::GetAtt": [
      "PostgreSQLInstanceSnapshotterparametersServiceRole23B2E630",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x"
   },
   "DependsOn": [
    "PostgreSQLInstanceSnapshotterparametersServiceRoleDefaultPolicy9C4B4594",
    "PostgreSQLInstanceSnapshotterparametersServiceRole23B2E630"
   ]
  },
  "PostgreSQLInstanceSnapshotterwaitServiceRole7815F7FF": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "PostgreSQLInstanceSnapshotterwaitServiceRoleDefaultPolicy20C24234": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "rds:DescribeDBClusters",
        "rds:DescribeDBClusterSnapshots",
        "rds:DescribeDBSnapshots",
        "rds:DescribeDBInstances"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:",
           {
            "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresInstance8F00D2DD14EE3CD9"
           }
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:",
           {
            "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresInstance8F00D2DD14EE3CD9"
           }
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:psql-instance-snapshot-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLInstanceSnapshotterwaitServiceRoleDefaultPolicy20C24234",
    "Roles": [
     {
      "Ref": "PostgreSQLInstanceSnapshotterwaitServiceRole7815F7FF"
     }
    ]
   }
  },
  "PostgreSQLInstanceSnapshotterwaitE64141BC": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "66486f7e33c34ceaae0d26eda8231c31f462018de9b6f34e598b3cc0df48b44f.zip"
    },
    "Description": "src/wait.lambda.ts",
    "Environment": {
     "Variables": {
      "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1"
     }
    },
    "Handler": "index.handler",
    "LoggingConfig": {
     "LogFormat": "JSON",
     "LogGroup": {
      "Ref": "PostgreSQLInstanceSnapshotterLogsF028D514"
     }
    },
    "Role": {
     "Fn::GetAtt": [
      "PostgreSQLInstanceSnapshotterwaitServiceRole7815F7FF",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x"
   },
   "DependsOn": [
    "PostgreSQLInstanceSnapshotterwaitServiceRoleDefaultPolicy20C24234",
    "PostgreSQLInstanceSnapshotterwaitServiceRole7815F7FF"
   ]
  },
  "PostgreSQLInstanceSnapshotterMySQLTaskTaskRoleB2EF5D11": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLInstanceSnapshotterMySQLTask53136402": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Command": [
       "bash",
       "-c",
       "echo \"[client]\nuser=$MYSQL_USER\nhost=$MYSQL_HOST\nport=$MYSQL_PORT\npassword=$MYSQL_PASSWORD\" > ~/.my.cnf && chmod 700 ~/.my.cnf"
      ],
      "Essential": false,
      "Image": "public.ecr.aws/docker/library/bash:4-alpine3.15",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "PostgreSQLInstanceSnapshotterLogsF028D514"
        },
        "awslogs-stream-prefix": "mysql-config",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "MountPoints": [
       {
        "ContainerPath": "/root",
        "ReadOnly": false,
        "SourceVolume": "config"
       }
      ],
      "Name": "config"
     },
     {
      "Command": [
       "mysql",
       "-e",
       "SELECT 1"
      ],
      "DependsOn": [
       {
        "Condition": "SUCCESS",
        "ContainerName": "config"
       }
      ],
      "Essential": true,
      "Image": "public.ecr.aws/lts/mysql:latest",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "PostgreSQLInstanceSnapshotterLogsF028D514"
        },
        "awslogs-stream-prefix": "mysql-sanitize",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "MountPoints": [
       {
        "ContainerPath": "/root",
        "ReadOnly": true,
        "SourceVolume": "config"
       }
      ],
      "Name": "mysql"
     }
    ],
    "Cpu": "256",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLInstanceSnapshotterMySQLTaskExecutionRoleD0258DFF",
      "Arn"
     ]
    },
    "Family": "RDSSanitizedSnapshotterSFNPostgreSQLInstanceSnapshotterMySQLTask1F6F549C",
    "Memory": "512",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLInstanceSnapshotterMySQLTaskTaskRoleB2EF5D11",
      "Arn"
     ]
    },
    "Volumes": [
     {
      "Host": {},
      "Name": "config"
     }
    ]
   }
  },
  "PostgreSQLInstanceSnapshotterMySQLTaskExecutionRoleD0258DFF": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLInstanceSnapshotterMySQLTaskExecutionRoleDefaultPolicyBC957120": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterLogsF028D514",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLInstanceSnapshotterMySQLTaskExecutionRoleDefaultPolicyBC957120",
    "Roles": [
     {
      "Ref": "PostgreSQLInstanceSnapshotterMySQLTaskExecutionRoleD0258DFF"
     }
    ]
   }
  },
  "PostgreSQLInstanceSnapshotterPostreSQLTaskTaskRole04FEDCFB": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLInstanceSnapshotterPostreSQLTask3DC21CCB": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Command": [
       "psql",
       "-c",
       "SELECT 1"
      ],
      "Essential": true,
      "Image": "public.ecr.aws/lts/postgres:latest",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "PostgreSQLInstanceSnapshotterLogsF028D514"
        },
        "awslogs-stream-prefix": "psql-sanitize",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "Name": "postgres"
     }
    ],
    "Cpu": "256",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLInstanceSnapshotterPostreSQLTaskExecutionRoleF7C4A7FB",
      "Arn"
     ]
    },
    "Family": "RDSSanitizedSnapshotterSFNPostgreSQLInstanceSnapshotterPostreSQLTask00FF05BB",
    "Memory": "512",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLInstanceSnapshotterPostreSQLTaskTaskRole04FEDCFB",
      "Arn"
     ]
    }
   }
  },
  "PostgreSQLInstanceSnapshotterPostreSQLTaskExecutionRoleF7C4A7FB": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLInstanceSnapshotterPostreSQLTaskExecutionRoleDefaultPolicy9201194B": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterLogsF028D514",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLInstanceSnapshotterPostreSQLTaskExecutionRoleDefaultPolicy9201194B",
    "Roles": [
     {
      "Ref": "PostgreSQLInstanceSnapshotterPostreSQLTaskExecutionRoleF7C4A7FB"
     }
    ]
   }
  },
  "PostgreSQLInstanceSnapshotterDirectorRole89143BB2": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": {
         "Fn::FindInMap": [
          "ServiceprincipalMap",
          {
           "Ref": "AWS::Region"
          },
          "states"
         ]
        }
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLInstanceSnapshotterDirectorRoleDefaultPolicyC372C868": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "PostgreSQLInstanceSnapshotterparametersA0CF862A",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "PostgreSQLInstanceSnapshotterparametersA0CF862A",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:deleteDBSnapshot",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":snapshot:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:deleteDBInstance",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:createDBSnapshot",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "PostgreSQLInstanceSnapshotterwaitE64141BC",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "PostgreSQLInstanceSnapshotterwaitE64141BC",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:restoreDBInstanceFromDBSnapshot",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":subgrp:",
           {
            "Ref": "PostgreSQLInstanceSnapshotterSubnetgroup7F19C7EE"
           }
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:modifyDBInstance",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:describeDBInstances",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "ecs:RunTask",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLInstanceSnapshotterMySQLTask53136402"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            2,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLInstanceSnapshotterMySQLTask53136402"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            3,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLInstanceSnapshotterMySQLTask53136402"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            4,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLInstanceSnapshotterMySQLTask53136402"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            0,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "PostgreSQLInstanceSnapshotterMySQLTask53136402"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          },
          "/",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "PostgreSQLInstanceSnapshotterMySQLTask53136402"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      },
      {
       "Action": [
        "ecs:StopTask",
        "ecs:DescribeTasks"
       ],
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "iam:PassRole",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "PostgreSQLInstanceSnapshotterMySQLTaskTaskRoleB2EF5D11",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "PostgreSQLInstanceSnapshotterMySQLTaskExecutionRoleD0258DFF",
          "Arn"
         ]
        }
       ]
      },
      {
       "Action": [
        "events:PutTargets",
        "events:PutRule",
        "events:DescribeRule"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":events:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":rule/StepFunctionsGetEventsForECSTaskRule"
         ]
        ]
       }
      },
      {
       "Action": "ecs:RunTask",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLInstanceSnapshotterPostreSQLTask3DC21CCB"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            2,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLInstanceSnapshotterPostreSQLTask3DC21CCB"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            3,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLInstanceSnapshotterPostreSQLTask3DC21CCB"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            4,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLInstanceSnapshotterPostreSQLTask3DC21CCB"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            0,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "PostgreSQLInstanceSnapshotterPostreSQLTask3DC21CCB"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          },
          "/",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "PostgreSQLInstanceSnapshotterPostreSQLTask3DC21CCB"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      },
      {
       "Action": "iam:PassRole",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "PostgreSQLInstanceSnapshotterPostreSQLTaskTaskRole04FEDCFB",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "PostgreSQLInstanceSnapshotterPostreSQLTaskExecutionRoleF7C4A7FB",
          "Arn"
         ]
        }
       ]
      },
      {
       "Action": "rds:AddTagsToResource",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":snapshot:psql-instance-snapshot-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "kms:CreateGrant",
        "kms:DescribeKey"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputFnGetAttKey961B73FDArn5A860C43"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLInstanceSnapshotterDirectorRoleDefaultPolicyC372C868",
    "Roles": [
     {
      "Ref": "PostgreSQLInstanceSnapshotterDirectorRole89143BB2"
     }
    ]
   }
  },
  "PostgreSQLInstanceSnapshotterDirector22C6400C": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"Get Parameters\",\"States\":{\"Get Parameters\":{\"Next\":\"Error Catcher\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterparametersA0CF862A",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"executionId.$\":\"$$.Execution.Id\",\"isCluster\":false,\"databaseIdentifier\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresInstance8F00D2DD14EE3CD9"
       },
       "\",\"databaseKey\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputFnGetAttKey961B73FDArn5A860C43"
       },
       "\",\"snapshotPrefix\":\"psql-instance-snapshot\",\"tempPrefix\":\"sanitize\"}},\"Error Catcher\":{\"Type\":\"Parallel\",\"ResultPath\":null,\"Next\":\"Cleanup\",\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":null,\"Next\":\"Cleanup\"}],\"Branches\":[{\"StartAt\":\"Create Temporary Snapshot\",\"States\":{\"Create Temporary Snapshot\":{\"Next\":\"Wait for Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBSnapshot\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.databaseIdentifier\",\"DbSnapshotIdentifier.$\":\"$.tempSnapshotId\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresInstance8F00D2DD14EE3CD9"
       },
       "\"}]}},\"Wait for Snapshot\":{\"Next\":\"Create Temporary Database\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterwaitE64141BC",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"snapshot\",\"databaseIdentifier.$\":\"$.databaseIdentifier\",\"snapshotIdentifier.$\":\"$.tempSnapshotId\",\"isCluster\":false}},\"Create Temporary Database\":{\"Next\":\"Wait for Temporary Database\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:restoreDBInstanceFromDBSnapshot\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\",\"Engine.$\":\"$.engine\",\"DbSnapshotIdentifier.$\":\"$.tempSnapshotId\",\"PubliclyAccessible\":false,\"VpcSecurityGroupIds\":[\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterSG97FD02BB",
         "GroupId"
        ]
       },
       "\"],\"DbSubnetGroupName\":\"",
       {
        "Ref": "PostgreSQLInstanceSnapshotterSubnetgroup7F19C7EE"
       },
       "\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresInstance8F00D2DD14EE3CD9"
       },
       "\"}]}},\"Wait for Temporary Database\":{\"Next\":\"Set Temporary Password\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterwaitE64141BC",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"instance\",\"databaseIdentifier.$\":\"$.tempDbId\",\"isCluster\":false}},\"Set Temporary Password\":{\"Next\":\"Wait for Temporary Password\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:modifyDBInstance\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\",\"MasterUserPassword.$\":\"$.tempDb.password\",\"ApplyImmediately\":true,\"BackupRetentionPeriod\":0}},\"Wait for Temporary Password\":{\"Next\":\"Get Temporary Endpoint\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterwaitE64141BC",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"instance\",\"databaseIdentifier.$\":\"$.tempDbId\",\"isCluster\":false}},\"Get Temporary Endpoint\":{\"Next\":\"Sanitize\",\"Type\":\"Task\",\"ResultPath\":\"$.tempDb.host\",\"ResultSelector\":{\"endpoint.$\":\"$.DbInstances[0].Endpoint.Address\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:describeDBInstances\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\"}},\"Sanitize\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.dockerImage\",\"StringEquals\":\"mysql\",\"Next\":\"Sanitize MySQL\"},{\"Variable\":\"$.dockerImage\",\"StringEquals\":\"postgres\",\"Next\":\"Sanitize Postgres\"}]},\"Sanitize MySQL\":{\"Next\":\"Create Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::ecs:runTask.sync\",\"Parameters\":{\"Cluster\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshottercluster067EC069",
         "Arn"
        ]
       },
       "\",\"TaskDefinition\":\"RDSSanitizedSnapshotterSFNPostgreSQLInstanceSnapshotterMySQLTask1F6F549C\",\"NetworkConfiguration\":{\"AwsvpcConfiguration\":{\"Subnets\":[\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet1SubnetEBD00FC6298E81EF"
       },
       "\",\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet2Subnet4B1C8CAAD8B83B81"
       },
       "\"],\"SecurityGroups\":[\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterSG97FD02BB",
         "GroupId"
        ]
       },
       "\"]}},\"Overrides\":{\"ContainerOverrides\":[{\"Name\":\"config\",\"Environment\":[{\"Name\":\"MYSQL_HOST\",\"Value.$\":\"$.tempDb.host.endpoint\"},{\"Name\":\"MYSQL_PORT\",\"Value.$\":\"$.tempDb.port\"},{\"Name\":\"MYSQL_USER\",\"Value.$\":\"$.tempDb.user\"},{\"Name\":\"MYSQL_PASSWORD\",\"Value.$\":\"$.tempDb.password\"},{\"Name\":\"MYSQL_DATABASE\",\"Value\":\"\"}]}]},\"LaunchType\":\"FARGATE\"}},\"Create Final Snapshot\":{\"Next\":\"Wait for Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBSnapshot\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\",\"DbSnapshotIdentifier.$\":\"$.targetSnapshotId\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresInstance8F00D2DD14EE3CD9"
       },
       "\"},{\"Key\":\"Final\",\"Value\":\"true\"}]}},\"Sanitize Postgres\":{\"Next\":\"Create Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::ecs:runTask.sync\",\"Parameters\":{\"Cluster\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshottercluster067EC069",
         "Arn"
        ]
       },
       "\",\"TaskDefinition\":\"RDSSanitizedSnapshotterSFNPostgreSQLInstanceSnapshotterPostreSQLTask00FF05BB\",\"NetworkConfiguration\":{\"AwsvpcConfiguration\":{\"Subnets\":[\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet1SubnetEBD00FC6298E81EF"
       },
       "\",\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet2Subnet4B1C8CAAD8B83B81"
       },
       "\"],\"SecurityGroups\":[\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterSG97FD02BB",
         "GroupId"
        ]
       },
       "\"]}},\"Overrides\":{\"ContainerOverrides\":[{\"Name\":\"postgres\",\"Environment\":[{\"Name\":\"PGHOST\",\"Value.$\":\"$.tempDb.host.endpoint\"},{\"Name\":\"PGPORT\",\"Value.$\":\"$.tempDb.port\"},{\"Name\":\"PGUSER\",\"Value.$\":\"$.tempDb.user\"},{\"Name\":\"PGPASSWORD\",\"Value.$\":\"$.tempDb.password\"},{\"Name\":\"PGDATABASE\",\"Value\":\"postgres\"},{\"Name\":\"PGCONNECT_TIMEOUT\",\"Value\":\"30\"}]}]},\"LaunchType\":\"FARGATE\"}},\"Wait for Final Snapshot\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLInstanceSnapshotterwaitE64141BC",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"snapshot\",\"databaseIdentifier.$\":\"$.tempDbId\",\"snapshotIdentifier.$\":\"$.targetSnapshotId\",\"isCluster\":false}}}}]},\"Cleanup\":{\"Type\":\"Parallel\",\"ResultPath\":null,\"End\":true,\"Branches\":[{\"StartAt\":\"Temporary Snapshot\",\"States\":{\"Temporary Snapshot\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBSnapshot\",\"Parameters\":{\"DbSnapshotIdentifier.$\":\"$.tempSnapshotId\"}}}},{\"StartAt\":\"Temporary Database Instance\",\"States\":{\"Temporary Database Instance\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBInstance\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbId\",\"SkipFinalSnapshot\":true}}}}]}}}"
      ]
     ]
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLInstanceSnapshotterDirectorRole89143BB2",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "PostgreSQLInstanceSnapshotterDirectorRoleDefaultPolicyC372C868",
    "PostgreSQLInstanceSnapshotterDirectorRole89143BB2"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "SnapshotKey0EDEBDF6": {
   "Type": "AWS::KMS::Key",
   "Properties": {
    "Description": "RDS sanitize test target key",
    "KeyPolicy": {
     "Statement": [
      {
       "Action": "kms:*",
       "Effect": "Allow",
       "Principal": {
        "AWS": {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":iam::",
           {
            "Ref": "AWS::AccountId"
           },
           ":root"
          ]
         ]
        }
       },
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    }
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "PostgreSQLClusterSnapshotterSG7FF985A8": {
   "Type": "AWS::EC2::SecurityGroup",
   "Properties": {
    "GroupDescription": "Group for communication between sanitizing job and database",
    "SecurityGroupEgress": [
     {
      "CidrIp": "0.0.0.0/0",
      "Description": "Allow all outbound traffic by default",
      "IpProtocol": "-1"
     }
    ],
    "Tags": [
     {
      "Key": "Name",
      "Value": "RDS-sanitized-snapshots"
     }
    ],
    "VpcId": {
     "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCB9E5F0B4BD23A326"
    }
   }
  },
  "PostgreSQLClusterSnapshotterSGfromRDSSanitizedSnapshotterSFNPostgreSQLClusterSnapshotterSGD655B838ALLPORTS45F04871": {
   "Type": "AWS::EC2::SecurityGroupIngress",
   "Properties": {
    "Description": "from RDSSanitizedSnapshotterSFNPostgreSQLClusterSnapshotterSGD655B838:ALL PORTS",
    "FromPort": 0,
    "GroupId": {
     "Fn::GetAtt": [
      "PostgreSQLClusterSnapshotterSG7FF985A8",
      "GroupId"
     ]
    },
    "IpProtocol": "tcp",
    "SourceSecurityGroupId": {
     "Fn::GetAtt": [
      "PostgreSQLClusterSnapshotterSG7FF985A8",
      "GroupId"
     ]
    },
    "ToPort": 65535
   }
  },
  "PostgreSQLClusterSnapshotterSubnetgroupA37EB2B3": {
   "Type": "AWS::RDS::DBSubnetGroup",
   "Properties": {
    "DBSubnetGroupDescription": "Temporary database used for RDS-sanitize-snapshots",
    "SubnetIds": [
     {
      "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCPrivateSubnet1Subnet8BCA10E01F79A1B7"
     },
     {
      "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCPrivateSubnet2SubnetCFCDAA7AB22CF85D"
     }
    ]
   }
  },
  "PostgreSQLClusterSnapshotterclusterD066B562": {
   "Type": "AWS::ECS::Cluster"
  },
  "PostgreSQLClusterSnapshotterLogsD5C5A603": {
   "Type": "AWS::Logs::LogGroup",
   "Properties": {
    "RetentionInDays": 30
   },
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  },
  "PostgreSQLClusterSnapshotterparametersServiceRoleB3208E28": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "PostgreSQLClusterSnapshotterparametersServiceRoleDefaultPolicy82F25ECA": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "rds:DescribeDBClusters",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster:",
          {
           "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresCluster5A5B7BE8BE4E3D78"
          }
         ]
        ]
       }
      },
      {
       "Action": "rds:DescribeDBInstances",
       "Effect": "Allow",
       "Resource": "*"
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLClusterSnapshotterparametersServiceRoleDefaultPolicy82F25ECA",
    "Roles": [
     {
      "Ref": "PostgreSQLClusterSnapshotterparametersServiceRoleB3208E28"
     }
    ]
   }
  },
  "PostgreSQLClusterSnapshotterparameters25147BEC": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "73ae9c6df09ad4bfbc13c9d4e1f9695a2de8da41bbb8b0037182a8cda9a710c6.zip"
    },
    "Description": "src/parameters.lambda.ts",
    "Environment": {
     "Variables": {
      "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1"
     }
    },
    "Handler": "index.handler",
    "LoggingConfig": {
     "LogFormat": "JSON",
     "LogGroup": {
      "Ref": "PostgreSQLClusterSnapshotterLogsD5C5A603"
     }
    },
    "Role": {
     "Fn::GetAtt": [
      "PostgreSQLClusterSnapshotterparametersServiceRoleB3208E28",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x"
   },
   "DependsOn": [
    "PostgreSQLClusterSnapshotterparametersServiceRoleDefaultPolicy82F25ECA",
    "PostgreSQLClusterSnapshotterparametersServiceRoleB3208E28"
   ]
  },
  "PostgreSQLClusterSnapshotterwaitServiceRole662B9A5C": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "lambda.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "ManagedPolicyArns": [
     {
      "Fn::Join": [
       "",
       [
        "arn:",
        {
         "Ref": "AWS::Partition"
        },
        ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
       ]
      ]
     }
    ]
   }
  },
  "PostgreSQLClusterSnapshotterwaitServiceRoleDefaultPolicyB7AEBC76": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "rds:DescribeDBClusters",
        "rds:DescribeDBClusterSnapshots",
        "rds:DescribeDBSnapshots",
        "rds:DescribeDBInstances"
       ],
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:",
           {
            "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresCluster5A5B7BE8BE4E3D78"
           }
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:",
           {
            "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresCluster5A5B7BE8BE4E3D78"
           }
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:psql-cluster-snapshot-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLClusterSnapshotterwaitServiceRoleDefaultPolicyB7AEBC76",
    "Roles": [
     {
      "Ref": "PostgreSQLClusterSnapshotterwaitServiceRole662B9A5C"
     }
    ]
   }
  },
  "PostgreSQLClusterSnapshotterwait7A15A210": {
   "Type": "AWS::Lambda::Function",
   "Properties": {
    "Code": {
     "S3Bucket": {
      "Fn::Sub": "cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}"
     },
     "S3Key": "66486f7e33c34ceaae0d26eda8231c31f462018de9b6f34e598b3cc0df48b44f.zip"
    },
    "Description": "src/wait.lambda.ts",
    "Environment": {
     "Variables": {
      "AWS_NODEJS_CONNECTION_REUSE_ENABLED": "1"
     }
    },
    "Handler": "index.handler",
    "LoggingConfig": {
     "LogFormat": "JSON",
     "LogGroup": {
      "Ref": "PostgreSQLClusterSnapshotterLogsD5C5A603"
     }
    },
    "Role": {
     "Fn::GetAtt": [
      "PostgreSQLClusterSnapshotterwaitServiceRole662B9A5C",
      "Arn"
     ]
    },
    "Runtime": "nodejs18.x"
   },
   "DependsOn": [
    "PostgreSQLClusterSnapshotterwaitServiceRoleDefaultPolicyB7AEBC76",
    "PostgreSQLClusterSnapshotterwaitServiceRole662B9A5C"
   ]
  },
  "PostgreSQLClusterSnapshotterMySQLTaskTaskRoleE079F904": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLClusterSnapshotterMySQLTask9D91D3F5": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Command": [
       "bash",
       "-c",
       "echo \"[client]\nuser=$MYSQL_USER\nhost=$MYSQL_HOST\nport=$MYSQL_PORT\npassword=$MYSQL_PASSWORD\" > ~/.my.cnf && chmod 700 ~/.my.cnf"
      ],
      "Essential": false,
      "Image": "public.ecr.aws/docker/library/bash:4-alpine3.15",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "PostgreSQLClusterSnapshotterLogsD5C5A603"
        },
        "awslogs-stream-prefix": "mysql-config",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "MountPoints": [
       {
        "ContainerPath": "/root",
        "ReadOnly": false,
        "SourceVolume": "config"
       }
      ],
      "Name": "config"
     },
     {
      "Command": [
       "mysql",
       "-e",
       "SELECT 1"
      ],
      "DependsOn": [
       {
        "Condition": "SUCCESS",
        "ContainerName": "config"
       }
      ],
      "Essential": true,
      "Image": "public.ecr.aws/lts/mysql:latest",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "PostgreSQLClusterSnapshotterLogsD5C5A603"
        },
        "awslogs-stream-prefix": "mysql-sanitize",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "MountPoints": [
       {
        "ContainerPath": "/root",
        "ReadOnly": true,
        "SourceVolume": "config"
       }
      ],
      "Name": "mysql"
     }
    ],
    "Cpu": "256",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLClusterSnapshotterMySQLTaskExecutionRole82F4953B",
      "Arn"
     ]
    },
    "Family": "RDSSanitizedSnapshotterSFNPostgreSQLClusterSnapshotterMySQLTask9865F232",
    "Memory": "512",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLClusterSnapshotterMySQLTaskTaskRoleE079F904",
      "Arn"
     ]
    },
    "Volumes": [
     {
      "Host": {},
      "Name": "config"
     }
    ]
   }
  },
  "PostgreSQLClusterSnapshotterMySQLTaskExecutionRole82F4953B": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLClusterSnapshotterMySQLTaskExecutionRoleDefaultPolicy6066AB09": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterLogsD5C5A603",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLClusterSnapshotterMySQLTaskExecutionRoleDefaultPolicy6066AB09",
    "Roles": [
     {
      "Ref": "PostgreSQLClusterSnapshotterMySQLTaskExecutionRole82F4953B"
     }
    ]
   }
  },
  "PostgreSQLClusterSnapshotterPostreSQLTaskTaskRole4CCD7360": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLClusterSnapshotterPostreSQLTaskE150FEBD": {
   "Type": "AWS::ECS::TaskDefinition",
   "Properties": {
    "ContainerDefinitions": [
     {
      "Command": [
       "psql",
       "-c",
       "SELECT 1"
      ],
      "Essential": true,
      "Image": "public.ecr.aws/lts/postgres:latest",
      "LogConfiguration": {
       "LogDriver": "awslogs",
       "Options": {
        "awslogs-group": {
         "Ref": "PostgreSQLClusterSnapshotterLogsD5C5A603"
        },
        "awslogs-stream-prefix": "psql-sanitize",
        "awslogs-region": {
         "Ref": "AWS::Region"
        }
       }
      },
      "Name": "postgres"
     }
    ],
    "Cpu": "256",
    "ExecutionRoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLClusterSnapshotterPostreSQLTaskExecutionRole9B27EF24",
      "Arn"
     ]
    },
    "Family": "RDSSanitizedSnapshotterSFNPostgreSQLClusterSnapshotterPostreSQLTask914B7835",
    "Memory": "512",
    "NetworkMode": "awsvpc",
    "RequiresCompatibilities": [
     "FARGATE"
    ],
    "TaskRoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLClusterSnapshotterPostreSQLTaskTaskRole4CCD7360",
      "Arn"
     ]
    }
   }
  },
  "PostgreSQLClusterSnapshotterPostreSQLTaskExecutionRole9B27EF24": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": "ecs-tasks.amazonaws.com"
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLClusterSnapshotterPostreSQLTaskExecutionRoleDefaultPolicyC9A9FEA1": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": [
        "logs:CreateLogStream",
        "logs:PutLogEvents"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterLogsD5C5A603",
         "Arn"
        ]
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLClusterSnapshotterPostreSQLTaskExecutionRoleDefaultPolicyC9A9FEA1",
    "Roles": [
     {
      "Ref": "PostgreSQLClusterSnapshotterPostreSQLTaskExecutionRole9B27EF24"
     }
    ]
   }
  },
  "PostgreSQLClusterSnapshotterDirectorRole38961E19": {
   "Type": "AWS::IAM::Role",
   "Properties": {
    "AssumeRolePolicyDocument": {
     "Statement": [
      {
       "Action": "sts:AssumeRole",
       "Effect": "Allow",
       "Principal": {
        "Service": {
         "Fn::FindInMap": [
          "ServiceprincipalMap",
          {
           "Ref": "AWS::Region"
          },
          "states"
         ]
        }
       }
      }
     ],
     "Version": "2012-10-17"
    }
   }
  },
  "PostgreSQLClusterSnapshotterDirectorRoleDefaultPolicy6668829B": {
   "Type": "AWS::IAM::Policy",
   "Properties": {
    "PolicyDocument": {
     "Statement": [
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "PostgreSQLClusterSnapshotterparameters25147BEC",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "PostgreSQLClusterSnapshotterparameters25147BEC",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:deleteDBClusterSnapshot",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster-snapshot:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:deleteDBInstance",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":db:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:deleteDBCluster",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:createDBClusterSnapshot",
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "lambda:InvokeFunction",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "PostgreSQLClusterSnapshotterwait7A15A210",
          "Arn"
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           {
            "Fn::GetAtt": [
             "PostgreSQLClusterSnapshotterwait7A15A210",
             "Arn"
            ]
           },
           ":*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:copyDBClusterSnapshot",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster-snapshot:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:restoreDBClusterFromSnapshot",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":subgrp:",
           {
            "Ref": "PostgreSQLClusterSnapshotterSubnetgroupA37EB2B3"
           }
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:modifyDBCluster",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "rds:createDBInstance",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      },
      {
       "Action": "rds:describeDBClusters",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":rds:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":cluster:sanitize-*"
         ]
        ]
       }
      },
      {
       "Action": "ecs:RunTask",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLClusterSnapshotterMySQLTask9D91D3F5"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            2,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLClusterSnapshotterMySQLTask9D91D3F5"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            3,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLClusterSnapshotterMySQLTask9D91D3F5"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            4,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLClusterSnapshotterMySQLTask9D91D3F5"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            0,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "PostgreSQLClusterSnapshotterMySQLTask9D91D3F5"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          },
          "/",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "PostgreSQLClusterSnapshotterMySQLTask9D91D3F5"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      },
      {
       "Action": [
        "ecs:StopTask",
        "ecs:DescribeTasks"
       ],
       "Effect": "Allow",
       "Resource": "*"
      },
      {
       "Action": "iam:PassRole",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "PostgreSQLClusterSnapshotterMySQLTaskTaskRoleE079F904",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "PostgreSQLClusterSnapshotterMySQLTaskExecutionRole82F4953B",
          "Arn"
         ]
        }
       ]
      },
      {
       "Action": [
        "events:PutTargets",
        "events:PutRule",
        "events:DescribeRule"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Ref": "AWS::Partition"
          },
          ":events:",
          {
           "Ref": "AWS::Region"
          },
          ":",
          {
           "Ref": "AWS::AccountId"
          },
          ":rule/StepFunctionsGetEventsForECSTaskRule"
         ]
        ]
       }
      },
      {
       "Action": "ecs:RunTask",
       "Effect": "Allow",
       "Resource": {
        "Fn::Join": [
         "",
         [
          "arn:",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLClusterSnapshotterPostreSQLTaskE150FEBD"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            2,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLClusterSnapshotterPostreSQLTaskE150FEBD"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            3,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLClusterSnapshotterPostreSQLTaskE150FEBD"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            4,
            {
             "Fn::Split": [
              ":",
              {
               "Ref": "PostgreSQLClusterSnapshotterPostreSQLTaskE150FEBD"
              }
             ]
            }
           ]
          },
          ":",
          {
           "Fn::Select": [
            0,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "PostgreSQLClusterSnapshotterPostreSQLTaskE150FEBD"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          },
          "/",
          {
           "Fn::Select": [
            1,
            {
             "Fn::Split": [
              "/",
              {
               "Fn::Select": [
                5,
                {
                 "Fn::Split": [
                  ":",
                  {
                   "Ref": "PostgreSQLClusterSnapshotterPostreSQLTaskE150FEBD"
                  }
                 ]
                }
               ]
              }
             ]
            }
           ]
          }
         ]
        ]
       }
      },
      {
       "Action": "iam:PassRole",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::GetAtt": [
          "PostgreSQLClusterSnapshotterPostreSQLTaskTaskRole4CCD7360",
          "Arn"
         ]
        },
        {
         "Fn::GetAtt": [
          "PostgreSQLClusterSnapshotterPostreSQLTaskExecutionRole9B27EF24",
          "Arn"
         ]
        }
       ]
      },
      {
       "Action": "rds:AddTagsToResource",
       "Effect": "Allow",
       "Resource": [
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster-snapshot:psql-cluster-snapshot-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":cluster:sanitize-*"
          ]
         ]
        },
        {
         "Fn::Join": [
          "",
          [
           "arn:",
           {
            "Ref": "AWS::Partition"
           },
           ":rds:",
           {
            "Ref": "AWS::Region"
           },
           ":",
           {
            "Ref": "AWS::AccountId"
           },
           ":db:sanitize-*"
          ]
         ]
        }
       ]
      },
      {
       "Action": [
        "kms:CreateGrant",
        "kms:DescribeKey"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::GetAtt": [
         "SnapshotKey0EDEBDF6",
         "Arn"
        ]
       }
      },
      {
       "Action": [
        "kms:CreateGrant",
        "kms:DescribeKey"
       ],
       "Effect": "Allow",
       "Resource": {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputFnGetAttKey961B73FDArn5A860C43"
       }
      }
     ],
     "Version": "2012-10-17"
    },
    "PolicyName": "PostgreSQLClusterSnapshotterDirectorRoleDefaultPolicy6668829B",
    "Roles": [
     {
      "Ref": "PostgreSQLClusterSnapshotterDirectorRole38961E19"
     }
    ]
   }
  },
  "PostgreSQLClusterSnapshotterDirector864DA8F0": {
   "Type": "AWS::StepFunctions::StateMachine",
   "Properties": {
    "DefinitionString": {
     "Fn::Join": [
      "",
      [
       "{\"StartAt\":\"Get Parameters\",\"States\":{\"Get Parameters\":{\"Next\":\"Error Catcher\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterparameters25147BEC",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"executionId.$\":\"$$.Execution.Id\",\"isCluster\":true,\"databaseIdentifier\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresCluster5A5B7BE8BE4E3D78"
       },
       "\",\"databaseKey\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputFnGetAttKey961B73FDArn5A860C43"
       },
       "\",\"snapshotPrefix\":\"psql-cluster-snapshot\",\"tempPrefix\":\"sanitize\"}},\"Error Catcher\":{\"Type\":\"Parallel\",\"ResultPath\":null,\"Next\":\"Cleanup\",\"Catch\":[{\"ErrorEquals\":[\"States.ALL\"],\"ResultPath\":null,\"Next\":\"Cleanup\"}],\"Branches\":[{\"StartAt\":\"Create Temporary Snapshot\",\"States\":{\"Create Temporary Snapshot\":{\"Next\":\"Wait for Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBClusterSnapshot\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.databaseIdentifier\",\"DbClusterSnapshotIdentifier.$\":\"$.tempSnapshotId\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresCluster5A5B7BE8BE4E3D78"
       },
       "\"}]}},\"Wait for Snapshot\":{\"Next\":\"Re-encrypt Snapshot\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterwait7A15A210",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"snapshot\",\"databaseIdentifier.$\":\"$.databaseIdentifier\",\"snapshotIdentifier.$\":\"$.tempSnapshotId\",\"isCluster\":true}},\"Re-encrypt Snapshot\":{\"Next\":\"Wait for Re-encrypt\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:copyDBClusterSnapshot\",\"Parameters\":{\"SourceDBClusterSnapshotIdentifier.$\":\"$.tempSnapshotId\",\"TargetDBClusterSnapshotIdentifier.$\":\"$.tempEncSnapshotId\",\"KmsKeyId\":\"",
       {
        "Ref": "SnapshotKey0EDEBDF6"
       },
       "\",\"CopyTags\":false,\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresCluster5A5B7BE8BE4E3D78"
       },
       "\"}]}},\"Wait for Re-encrypt\":{\"Next\":\"Create Temporary Database\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterwait7A15A210",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"snapshot\",\"databaseIdentifier.$\":\"$.databaseIdentifier\",\"snapshotIdentifier.$\":\"$.tempEncSnapshotId\",\"isCluster\":true}},\"Create Temporary Database\":{\"Next\":\"Wait for Temporary Database\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:restoreDBClusterFromSnapshot\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"Engine.$\":\"$.engine\",\"SnapshotIdentifier.$\":\"$.tempEncSnapshotId\",\"PubliclyAccessible\":false,\"VpcSecurityGroupIds\":[\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterSG7FF985A8",
         "GroupId"
        ]
       },
       "\"],\"DbSubnetGroupName\":\"",
       {
        "Ref": "PostgreSQLClusterSnapshotterSubnetgroupA37EB2B3"
       },
       "\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresCluster5A5B7BE8BE4E3D78"
       },
       "\"}]}},\"Wait for Temporary Database\":{\"Next\":\"Set Temporary Password\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterwait7A15A210",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"cluster\",\"databaseIdentifier.$\":\"$.tempDbId\",\"isCluster\":true}},\"Set Temporary Password\":{\"Next\":\"Wait for Temporary Password\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:modifyDBCluster\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"MasterUserPassword.$\":\"$.tempDb.password\",\"ApplyImmediately\":true}},\"Wait for Temporary Password\":{\"Next\":\"Create Temporary Instance\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterwait7A15A210",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"cluster\",\"databaseIdentifier.$\":\"$.tempDbId\",\"isCluster\":true}},\"Create Temporary Instance\":{\"Next\":\"Wait for Temporary Instance\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBInstance\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"DbInstanceIdentifier.$\":\"$.tempDbInstanceId\",\"DbInstanceClass.$\":\"$.tempDbInstanceClass\",\"Engine.$\":\"$.engine\"}},\"Wait for Temporary Instance\":{\"Next\":\"Get Temporary Cluster Endpoint\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterwait7A15A210",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"instance\",\"databaseIdentifier.$\":\"$.tempDbInstanceId\",\"isCluster\":true}},\"Get Temporary Cluster Endpoint\":{\"Next\":\"Sanitize\",\"Type\":\"Task\",\"ResultPath\":\"$.tempDb.host\",\"ResultSelector\":{\"endpoint.$\":\"$.DbClusters[0].Endpoint\"},\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:describeDBClusters\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\"}},\"Sanitize\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.dockerImage\",\"StringEquals\":\"mysql\",\"Next\":\"Sanitize MySQL\"},{\"Variable\":\"$.dockerImage\",\"StringEquals\":\"postgres\",\"Next\":\"Sanitize Postgres\"}]},\"Sanitize MySQL\":{\"Next\":\"Create Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::ecs:runTask.sync\",\"Parameters\":{\"Cluster\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterclusterD066B562",
         "Arn"
        ]
       },
       "\",\"TaskDefinition\":\"RDSSanitizedSnapshotterSFNPostgreSQLClusterSnapshotterMySQLTask9865F232\",\"NetworkConfiguration\":{\"AwsvpcConfiguration\":{\"Subnets\":[\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet1SubnetEBD00FC6298E81EF"
       },
       "\",\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet2Subnet4B1C8CAAD8B83B81"
       },
       "\"],\"SecurityGroups\":[\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterSG7FF985A8",
         "GroupId"
        ]
       },
       "\"]}},\"Overrides\":{\"ContainerOverrides\":[{\"Name\":\"config\",\"Environment\":[{\"Name\":\"MYSQL_HOST\",\"Value.$\":\"$.tempDb.host.endpoint\"},{\"Name\":\"MYSQL_PORT\",\"Value.$\":\"$.tempDb.port\"},{\"Name\":\"MYSQL_USER\",\"Value.$\":\"$.tempDb.user\"},{\"Name\":\"MYSQL_PASSWORD\",\"Value.$\":\"$.tempDb.password\"},{\"Name\":\"MYSQL_DATABASE\",\"Value\":\"\"}]}]},\"LaunchType\":\"FARGATE\"}},\"Create Final Snapshot\":{\"Next\":\"Wait for Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:createDBClusterSnapshot\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"DbClusterSnapshotIdentifier.$\":\"$.targetSnapshotId\",\"Tags\":[{\"Key\":\"RDS-sanitized-snapshots\",\"Value\":\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-RDS:ExportsOutputRefPostgresCluster5A5B7BE8BE4E3D78"
       },
       "\"},{\"Key\":\"Final\",\"Value\":\"true\"}]}},\"Sanitize Postgres\":{\"Next\":\"Create Final Snapshot\",\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::ecs:runTask.sync\",\"Parameters\":{\"Cluster\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterclusterD066B562",
         "Arn"
        ]
       },
       "\",\"TaskDefinition\":\"RDSSanitizedSnapshotterSFNPostgreSQLClusterSnapshotterPostreSQLTask914B7835\",\"NetworkConfiguration\":{\"AwsvpcConfiguration\":{\"Subnets\":[\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet1SubnetEBD00FC6298E81EF"
       },
       "\",\"",
       {
        "Fn::ImportValue": "RDS-Sanitized-Snapshotter-VPC:ExportsOutputRefVPCIsolatedSubnet2Subnet4B1C8CAAD8B83B81"
       },
       "\"],\"SecurityGroups\":[\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterSG7FF985A8",
         "GroupId"
        ]
       },
       "\"]}},\"Overrides\":{\"ContainerOverrides\":[{\"Name\":\"postgres\",\"Environment\":[{\"Name\":\"PGHOST\",\"Value.$\":\"$.tempDb.host.endpoint\"},{\"Name\":\"PGPORT\",\"Value.$\":\"$.tempDb.port\"},{\"Name\":\"PGUSER\",\"Value.$\":\"$.tempDb.user\"},{\"Name\":\"PGPASSWORD\",\"Value.$\":\"$.tempDb.password\"},{\"Name\":\"PGDATABASE\",\"Value\":\"postgres\"},{\"Name\":\"PGCONNECT_TIMEOUT\",\"Value\":\"30\"}]}]},\"LaunchType\":\"FARGATE\"}},\"Wait for Final Snapshot\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2},{\"ErrorEquals\":[\"NotReady\"],\"IntervalSeconds\":60,\"MaxAttempts\":300,\"BackoffRate\":1}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"",
       {
        "Fn::GetAtt": [
         "PostgreSQLClusterSnapshotterwait7A15A210",
         "Arn"
        ]
       },
       "\",\"Parameters\":{\"resourceType\":\"snapshot\",\"databaseIdentifier.$\":\"$.tempDbId\",\"snapshotIdentifier.$\":\"$.targetSnapshotId\",\"isCluster\":true}}}}]},\"Cleanup\":{\"Type\":\"Parallel\",\"ResultPath\":null,\"End\":true,\"Branches\":[{\"StartAt\":\"Temporary Snapshot\",\"States\":{\"Temporary Snapshot\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBClusterSnapshot\",\"Parameters\":{\"DbClusterSnapshotIdentifier.$\":\"$.tempSnapshotId\"}}}},{\"StartAt\":\"Re-encrypted Snapshot\",\"States\":{\"Re-encrypted Snapshot\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBClusterSnapshot\",\"Parameters\":{\"DbClusterSnapshotIdentifier.$\":\"$.tempEncSnapshotId\"}}}},{\"StartAt\":\"Temporary Database Instance\",\"States\":{\"Temporary Database Instance\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBInstance\",\"Parameters\":{\"DbInstanceIdentifier.$\":\"$.tempDbInstanceId\",\"SkipFinalSnapshot\":true}}}},{\"StartAt\":\"Temporary Database\",\"States\":{\"Temporary Database\":{\"End\":true,\"Retry\":[{\"ErrorEquals\":[\"States.ALL\"],\"IntervalSeconds\":10,\"MaxAttempts\":5}],\"Type\":\"Task\",\"ResultPath\":null,\"Resource\":\"arn:",
       {
        "Ref": "AWS::Partition"
       },
       ":states:::aws-sdk:rds:deleteDBCluster\",\"Parameters\":{\"DbClusterIdentifier.$\":\"$.tempDbId\",\"SkipFinalSnapshot\":true}}}}]}}}"
      ]
     ]
    },
    "RoleArn": {
     "Fn::GetAtt": [
      "PostgreSQLClusterSnapshotterDirectorRole38961E19",
      "Arn"
     ]
    }
   },
   "DependsOn": [
    "PostgreSQLClusterSnapshotterDirectorRoleDefaultPolicy6668829B",
    "PostgreSQLClusterSnapshotterDirectorRole38961E19"
   ],
   "UpdateReplacePolicy": "Delete",
   "DeletionPolicy": "Delete"
  }
 },
 "Mappings": {
  "ServiceprincipalMap": {
   "af-south-1": {
    "states": "states.af-south-1.amazonaws.com"
   },
   "ap-east-1": {
    "states": "states.ap-east-1.amazonaws.com"
   },
   "ap-northeast-1": {
    "states": "states.ap-northeast-1.amazonaws.com"
   },
   "ap-northeast-2": {
    "states": "states.ap-northeast-2.amazonaws.com"
   },
   "ap-northeast-3": {
    "states": "states.ap-northeast-3.amazonaws.com"
   },
   "ap-south-1": {
    "states": "states.ap-south-1.amazonaws.com"
   },
   "ap-south-2": {
    "states": "states.ap-south-2.amazonaws.com"
   },
   "ap-southeast-1": {
    "states": "states.ap-southeast-1.amazonaws.com"
   },
   "ap-southeast-2": {
    "states": "states.ap-southeast-2.amazonaws.com"
   },
   "ap-southeast-3": {
    "states": "states.ap-southeast-3.amazonaws.com"
   },
   "ap-southeast-4": {
    "states": "states.ap-southeast-4.amazonaws.com"
   },
   "ca-central-1": {
    "states": "states.ca-central-1.amazonaws.com"
   },
   "cn-north-1": {
    "states": "states.cn-north-1.amazonaws.com"
   },
   "cn-northwest-1": {
    "states": "states.cn-northwest-1.amazonaws.com"
   },
   "eu-central-1": {
    "states": "states.eu-central-1.amazonaws.com"
   },
   "eu-central-2": {
    "states": "states.eu-central-2.amazonaws.com"
   },
   "eu-north-1": {
    "states": "states.eu-north-1.amazonaws.com"
   },
   "eu-south-1": {
    "states": "states.eu-south-1.amazonaws.com"
   },
   "eu-south-2": {
    "states": "states.eu-south-2.amazonaws.com"
   },
   "eu-west-1": {
    "states": "states.eu-west-1.amazonaws.com"
   },
   "eu-west-2": {
    "states": "states.eu-west-2.amazonaws.com"
   },
   "eu-west-3": {
    "states": "states.eu-west-3.amazonaws.com"
   },
   "il-central-1": {
    "states": "states.il-central-1.amazonaws.com"
   },
   "me-central-1": {
    "states": "states.me-central-1.amazonaws.com"
   },
   "me-south-1": {
    "states": "states.me-south-1.amazonaws.com"
   },
   "sa-east-1": {
    "states": "states.sa-east-1.amazonaws.com"
   },
   "us-east-1": {
    "states": "states.us-east-1.amazonaws.com"
   },
   "us-east-2": {
    "states": "states.us-east-2.amazonaws.com"
   },
   "us-gov-east-1": {
    "states": "states.us-gov-east-1.amazonaws.com"
   },
   "us-gov-west-1": {
    "states": "states.us-gov-west-1.amazonaws.com"
   },
   "us-iso-east-1": {
    "states": "states.amazonaws.com"
   },
   "us-iso-west-1": {
    "states": "states.amazonaws.com"
   },
   "us-isob-east-1": {
    "states": "states.amazonaws.com"
   },
   "us-west-1": {
    "states": "states.us-west-1.amazonaws.com"
   },
   "us-west-2": {
    "states": "states.us-west-2.amazonaws.com"
   }
  }
 },
 "Outputs": {
  "ExportsOutputRefMySQLInstanceSnapshotterDirector69A6B7B421EEFD9B": {
   "Value": {
    "Ref": "MySQLInstanceSnapshotterDirector69A6B7B4"
   },
   "Export": {
    "Name": "RDS-Sanitized-Snapshotter-SFN:ExportsOutputRefMySQLInstanceSnapshotterDirector69A6B7B421EEFD9B"
   }
  },
  "ExportsOutputRefMySQLClusterSnapshotterDirector73A14BB07F203611": {
   "Value": {
    "Ref": "MySQLClusterSnapshotterDirector73A14BB0"
   },
   "Export": {
    "Name": "RDS-Sanitized-Snapshotter-SFN:ExportsOutputRefMySQLClusterSnapshotterDirector73A14BB07F203611"
   }
  },
  "ExportsOutputRefPostgreSQLInstanceSnapshotterDirector22C6400CD7D4E9FC": {
   "Value": {
    "Ref": "PostgreSQLInstanceSnapshotterDirector22C6400C"
   },
   "Export": {
    "Name": "RDS-Sanitized-Snapshotter-SFN:ExportsOutputRefPostgreSQLInstanceSnapshotterDirector22C6400CD7D4E9FC"
   }
  },
  "ExportsOutputRefPostgreSQLClusterSnapshotterDirector864DA8F006C62DA7": {
   "Value": {
    "Ref": "PostgreSQLClusterSnapshotterDirector864DA8F0"
   },
   "Export": {
    "Name": "RDS-Sanitized-Snapshotter-SFN:ExportsOutputRefPostgreSQLClusterSnapshotterDirector864DA8F006C62DA7"
   }
  }
 },
 "Parameters": {
  "BootstrapVersion": {
   "Type": "AWS::SSM::Parameter::Value<String>",
   "Default": "/cdk-bootstrap/hnb659fds/version",
   "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
  }
 },
 "Rules": {
  "CheckBootstrapVersion": {
   "Assertions": [
    {
     "Assert": {
      "Fn::Not": [
       {
        "Fn::Contains": [
         [
          "1",
          "2",
          "3",
          "4",
          "5"
         ],
         {
          "Ref": "BootstrapVersion"
         }
        ]
       }
      ]
     },
     "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI."
    }
   ]
  }
 }
}